//Copyright 2010 Noritaka Horio All rights reserved. @licence The MIT Licence
(function(b){var a=this.StaticMaps=new Class({Implements:[Options],options:{},_validaters:{},_url:"http://maps.google.com/maps/api/staticmap",initialize:function(c){this.setOptions(c);this._setDefaultValues()},_set:function(g,f){var g=g.split(".");var e=g.shift();var d=g.shift();var c=this._validaters[e][d];c=c.capitalize();if(a.Validater["isValid"+c](f)){this[e][d]=f}},_get:function(e){var e=e.split(".");var d=e.shift();var c=e.shift();return this[d][c]},_getImage:function(){var c=new Element("img",{src:this.toQueryString()});if(a.Map!==undefined){var d=this.getSize();c.setProperties(this.getSize())}return c},renderTo:function(d){var c=this._getImage();c.inject(d)},_setDefaultValues:function(){var f=null,c=null,g=null;var e=a.Hooks.getDefaults();for(var d in e){if(e.hasOwnProperty(d)){c=d.replace("_","");f=this.options[c];g=e[d].bind(this);g(f)}}},toQueryString:function(){var h=[];var i=a.Hooks.getQueries();for(var e in i){if(i.hasOwnProperty(e)){var g=this[e];var f=i[e];var c=f(g);if(c!=""){h.push(c)}}}var d=this._url+"?"+h.join("&");return d},factory:function(e,d){var c=e.capitalize();if(a[c]===null||a[c]==="undefind"){throw new TypeError("The class that was able to make it to the instance was not found")}return a[c].factory(d)}});a.Point=new Class({_point:null,initialize:function(c){this.setValue(c||null)},setValue:function(c){if(!a.Validater.isValidPoint(c)){return}this._point=c},getValue:function(){return this._point},toString:function(){var c=null;switch(typeOf(this._point)){case"object":c=this._point.lat+","+this._point.lng;break;case"string":c=encodeURIComponent(this._point);break;default:c=null}return c}});a.Point.factory=function(c){return new a.Point(c)};a.Hooks={defaults:{},queries:{},getDefaults:function(){return this.defaults},getQueries:function(){return this.queries},registerDefaults:function(c,d){if(!Type.isFunction(d)){return}this.defaults[c]=d},registerQuery:function(c,d){if(!Type.isFunction(d)){return}this.queries[c]=d}};a.Validater={_markerSizes:["tiny","mid","small"],_formats:["png","png8","png32","gif","jpg","jpg-baseline"],_mapTypes:["roadmap","satellite","terrain","hybrid"],_languages:["aa","ab","af","am","ar","as","ay","az","ba","be","bg","bh","bi","bn","bo","br","ca","co","cs","cy","da","de","dz","el","en","eo","es","et","eu","fa","fi","fj","fo","fr","fy","ga","gd","gl","gn","gu","ha","hi","hr","hu","hy","ia","ie","ik","in","is","it","iw","ja","ji","jw","ka","kk","kl","km","kn","ko","ks","ku","ky","la","ln","lo","lt","lv","mg","mi","mk","ml","mn","mo","mr","ms","mt","my","na","ne","nl","no","oc","om","or","pa","pl","ps","pt","qu","rm","rn","ro","ru","rw","sa","sd","sg","sh","si","sk","sl","sm","sn","so","sq","sr","ss","st","su","sv","sw","ta","te","tg","th","ti","tk","tl","tn","to","tr","ts","tt","tw","uk","ur","uz","vi","vo","wo","xh","yo","zh","zu"],_colors:["black","brown","green","purple","yellow","blue","gray","orange","red","white"],isValidMapSize:function(c){if(!Type.isObject(c)){return false}if(!(Type.isNumber(c.width)&&Type.isNumber(c.height))||(c.width<=0||c.height<=0)){return false}return true},isValidMarkerSize:function(c){if(this._markerSizes.indexOf(c)<=-1){return false}return true},isValidLabel:function(c){if(!Type.isString(c)||!c.test(/^[A-Z0-9]{1}$/)){return false}return true},isValidFormat:function(c){if(this._formats.indexOf(c)<=-1){return false}return true},isValidMapType:function(c){if(this._mapTypes.indexOf(c)<=-1){return false}return true},isValidLanguage:function(c){if(this._languages.indexOf(c)<=-1){return false}return true},isValidColor:function(c){if(!Type.isString(c)){return false}if(!c.test(/^0x[A-Z0-9]{6}$/)&&this._colors.indexOf(c)<=-1){return false}return true},isValidPoint:function(c){if(!instanceOf(c,a.Point)){switch(typeOf(c)){case"object":if(!Type.isNumber(c.lat)||!Type.isNumber(c.lng)){return false}break;case"string":if(c.length<=0){return false}break;default:return false;break}}return true},isValidIcon:function(c){if(!Type.isString(c)){return false}if(!c.test(/^(((ht|f)tp(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/)){return false}return true},isValidZoom:function(c){if(!Type.isNumber(c)){return false}if(c<0||c>21){return false}return true},isValidBoolean:Type.isBoolean,isValidNumber:Type.isNumber}}(document.id));(function(c){var b=(this.StaticMaps||{});b.implement({options:{map:{size:{width:600,height:600},format:null,mapType:null,mobile:null,language:null,sensor:false}},_map:{size:null,format:null,mapType:null,mobile:null,language:null,sensor:false},_validaters:{_map:{size:"mapSize",format:"format",mapType:"mapType",mobile:"boolean",language:"language",sensor:"boolean"}},setSize:function(f,d){var e={width:f,height:d};this._set("_map.size",e);return this}});var a={};["size","format","mapType","mobile","language","sensor"].each(function(e){var d="_map."+e;var f="get"+e.capitalize();a[f]=function(){var g=this._get(d);return g}});["format","mapType","mobile","language","sensor"].each(function(f){var e="_map."+f;var d="set"+f.capitalize();a[d]=function(){var g=[e].append(Array.from(arguments));this._set.apply(this,g);return this}});b.implement(a);b.Map={};b.Map.setDefaults=function(e){var g=null,f=null;for(var d in e){g=d.capitalize();f=e[d];if(f===null||f===undefined){continue}if(e.hasOwnProperty(d)){switch(d){case"size":this.setSize(f.width,f.height);break;case"mapType":this.setMapType(f);break;default:this["set"+g](f);break}}}};b.Map.toQueryString=function(h){var g=[],f=null,e=null;for(var d in h){if(h.hasOwnProperty(d)){queryValue=h[d];e=d.toLowerCase();if(queryValue==null&&queryValue==undefined){continue}switch(d){case"size":g.push(e+"="+queryValue.width+"x"+queryValue.height);break;default:g.push(e+"="+queryValue)}}}return g.join("&")};b.Hooks.registerDefaults("_map",b.Map.setDefaults);b.Hooks.registerQuery("_map",b.Map.toQueryString)}(document.id));(function(c){var b=(this.StaticMaps||{});b.implement({options:{position:{center:null,zoom:null}},_position:{center:null,zoom:null},_validaters:{_position:{center:"point",zoom:"zoom"}},setCenter:function(d){if(!instanceOf(d,b.Point)){d=new b.Point(d)}this._set("_position.center",d);return this}});var a={};["center","zoom"].each(function(e){var d="_position."+e;var f="get"+e.capitalize();a[f]=function(){var g=this._get(d);return g}});["zoom"].each(function(f){var e="_position."+f;var d="set"+f.capitalize();a[d]=function(){var g=[e].append(Array.from(arguments));this._set.apply(this,g);return this}});b.implement(a);b.Position={};b.Position.setDefaults=function(e){var g=null,f=null;for(var d in e){if(e.hasOwnProperty(d)){g=d.capitalize();f=e[d];if(f===null||f===undefined){continue}if(e.hasOwnProperty(d)){this["set"+g](f)}}}};b.Position.toQueryString=function(e){var f=[];var d=e.center;if(d){if(d.getValue()!==null){f.push("center="+d.toString())}}if(e.zoom){f.push("zoom="+e.zoom)}return f.join("&")};b.Hooks.registerDefaults("_position",b.Position.setDefaults);b.Hooks.registerQuery("_position",b.Position.toQueryString)}(document.id));(function(c){var b=(this.StaticMaps||{});b.implement({options:{markers:[]},_markers:[],addMarker:function(d){if(!instanceOf(d,b.Marker)){d=new b.Marker(d)}this._markers.push(d);return d},addMarkers:function(g){var e=[],d=null;for(var f=0;f<g.length;f++){d=this.addMarker(g[f]);if(!d){continue}e.push(d)}return e},removeMarker:function(d){this._markers.erase(d)},removeMarkers:function(e){for(var d=0;d<this._markers.length;d++){this.removeMarker(e[d])}}});b.Marker=new Class({_color:null,_size:null,_label:null,_icon:null,_shadow:true,_point:null,initialize:function(e){var d=e=(e||{});this.setProperties(d)},_set:function(e,f){var d=b.Marker.validaters[e];if(b.Validater["isValid"+d.capitalize()](f)){this[e]=f}},_get:function(d){return this[d]},setProperties:function(e){var g=null,f=null;for(var d in e){if(e.hasOwnProperty(d)){g=d.capitalize();f=e[d];this["set"+g](f)}}},getProperties:function(){var f={},e=null;var g=b.Marker.orderKeys;for(var d=0;d<g.length;d++){e=g[d];f[e]=this[e]}return f},setPoint:function(d){if(!instanceOf(d,b.Point)){d=new b.Point(d)}this._set("_point",d);return this},toQueryString:function(){var j=[],g=null,h=null;var e=b.Marker.orderKeys;var d=b.Marker.orderKeys.length;for(var f=0;f<d;f++){g=e[f];h=this[g];if(h==null&&h==undefined){continue}switch(g){case"_point":j.push(h.toString());break;default:j.push(g.replace("_","")+":"+h);break}}return j.join("|")}});var a={};["_color","_size","_label","_icon","_shadow","_point"].each(function(d){var e="get"+d.replace("_","").capitalize();a[e]=function(){var f=this._get(d);return f}});["_color","_size","_label","_icon","_shadow"].each(function(e){var d="set"+e.replace("_","").capitalize();a[d]=function(){var f=[e].append(Array.from(arguments));this._set.apply(this,f);return this}});b.Marker.validaters={_color:"color",_size:"markerSize",_label:"label",_icon:"icon",_shadow:"boolean",_point:"point"};b.Marker.implement(a);b.Marker.orderKeys=["_color","_size","_label","_icon","_shadow","_point"];b.Marker.setDefaults=function(g){var e=null,d=g.length;for(var f=0;d>f;f++){this.addMarker(g[f])}};b.Marker.factory=function(g){var f=Object.subset(g||{},["color","size","label","icon","shadow","point"]);for(var e in f){if(f.hasOwnProperty(e)){if(f[e]==undefined){delete f[e]}}}var d=new b.Marker(f);return d};b.Marker.toQueryString=function(j){var h=[],f=[];if(j.length<=0){return""}var g=Array.clone(j);var d=g.shift();f.push(d.toQueryString());for(var e=0;e<g.length;e++){d=g[e];if(d.getColor()||d.getLabel()||d.getSize()){h.push("markers="+f.join("|"));f=[]}f.push(d.toQueryString())}h.push("markers="+f.join("|"));return h.join("&")};b.Hooks.registerDefaults("_markers",b.Marker.setDefaults);b.Hooks.registerQuery("_markers",b.Marker.toQueryString)}(document.id));(function(c){var b=(this.StaticMaps||{});b.implement({options:{path:{weight:null,color:null,fillColor:null,points:[]}},_path:{weight:null,color:null,fillColor:null,points:[]},_validaters:{_path:{weight:"number",color:"color",fillColor:"color"}},addPathPoint:function(d){if(!instanceOf(d,b.Point)){if(!b.Validater.isValidPoint(d)){return}d=new b.Point(d)}var e=this._get("_path.points");e.push(d);return d},addPathPoints:function(g){var f=[],d=null;for(var e=0;e<g.length;e++){d=this.addPathPoint(g[e]);if(!d){continue}f.push(d)}return f},removePathPoint:function(d){var e=this._get("_path.points");e.erase(d)},removePathPoints:function(e){e=e||this._get("_path.points");for(var d=0;d<e.length;d++){this.removePathPoint(e[d])}}});var a={};["weight","color","fillColor"].each(function(f){var e="_path."+f;var g="getPath"+f.capitalize();var d="setPath"+f.capitalize();a[g]=function(){var h=this._get(e);return h};a[d]=function(){var h=[e].append(Array.from(arguments));this._set.apply(this,h);return this}});b.implement(a);b.Path={};b.Path.orderKeys=["weight","color","fillColor","points"];b.Path.setDefaults=function(f){var g=null,e=null;for(var d in f){e=f[d];if(f.hasOwnProperty(d)){g=d.capitalize();switch(d){case"points":this.addPathPoints(e);break;default:this["setPath"+g](e)}}}};b.Path.toQueryString=function(n){var m=[],h=null,k=null;var f=b.Path.orderKeys;var d=f.length;for(var g=0;g<d;g++){h=f[g];k=n[h];if(k==null&&k==undefined){continue}switch(h){case"points":for(var e=0;e<k.length;e++){m.push(k[e].toString())}break;default:m.push(h.toLowerCase()+":"+k);break}}return"path="+m.join("|")};b.Hooks.registerDefaults("_path",b.Path.setDefaults);b.Hooks.registerQuery("_path",b.Path.toQueryString)}(document.id));